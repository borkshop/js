<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="index.css" />
    <title>Cascading DOMgeon Template</title>
  </head>
  <body>

    <header>
    </header>

    <main>
      <aside class="menu modal">
        <noscript>
          <section>
            <h3 class="error">DOMgeoneering requires JavaScript</h3>
          </section>
        </noscript>

        <section>
          <h1>Cascading DOMgeon Template</h1>
        </section>

        <fieldset>
          <legend>TODO:</legend>
          <ul>
            <li>the void should be an other plane...</li>
            <li>things to find and do there</li>
            <li>...how to return back to the solid plane?</li>
            <li>visibility ala <a ref="https://www.albertford.com/shadowcasting">shadow casting</a></li>
            <li>maybe inventory and items</li>
          </ul>
        </fieldset>


        <fieldset id="inspector">
          <legend>
            <label for="inspector-ids">Tiles @<span data-for="pos">X,Y</span>:</label>
          </legend>
          <textarea readonly style="border: none; resize: none; user-select: all; width: 100%;"></textarea>
        </fieldset>

        <div style="float: right">
          <h3><a href="index.html">Back to Welcome screen</a></h3>
        </div>

      </aside>

      <style>
        /* tile stacking priorities */
        .tile.floor { z-index:  0 }
        .tile       { z-index:  5 }
        .tile.wall  { z-index: 10 }
        .tile.mover { z-index: 20 }
        .tile.input { z-index: 50 }

        .tile.floor { color: var(--dark-grey) }

        /* wall should occlude floor */
        .tile.wall { background-color: var(--darker-grey) }

        .tile.mover { color: var(--orange); }

        .tile.door {
          --action: "open";
          --morph_target: "!passable";
        }
        .tile.door::before { content: "+" }

        .tile.door.passable { --action: "close" }
        .tile.door.passable::before { content: "-" }

        .tile.rune { color: var(--purple) }
      </style>
      <div class="grid">
      </div>

    </main>

    <div class="buttonbar moves left"></div>
    <div class="buttonbar actions right float"></div>

    <script type="module">
      import {DOMgeon, DOMgeonInspector} from 'cdom/domgeon';
      import {fillRect, roomShader, borderShader} from 'cdom/builder';
      const dmg = window.dmg = new DOMgeon({
        ui: document.body,
        keys: document.body,
        grid: document.querySelector('main .grid'),
        moveBar: document.querySelector('.buttonbar.moves'),
        actionBar: document.querySelector('.buttonbar.actions'),
      });
      new DOMgeonInspector(dmg, document.querySelector('#inspector'));

      const floorShader = {kind: 'floor', classList: ['support', 'passable'], text: 'Â·'};
      const wallShader = {kind: 'wall', text: '#'};
      const doorShader = {kind: 'door', classList: ['interact']};

      fillRect(dmg.grid, {x: 0, y: 0, w: 13, h: 8}, roomShader({
        floors: floorShader,
        walls: wallShader,
        doors: doorShader,
        doorsAt: (pos, rect) => 
          pos.x === rect.x + Math.floor(rect.w/2),
      }));

      fillRect(dmg.grid, {x: 5, y: -5, w: 3, h: 5}, roomShader({
        floors: floorShader,
        walls: borderShader(null, wallShader),
      }));

      fillRect(dmg.grid, {x: 4, y: -10, w: 5, h: 5}, roomShader({
        floors: floorShader,
        walls: wallShader,
        doors: doorShader,
        doorsAt: (pos, rect) => 
          pos.x === rect.x + Math.floor(rect.w/2) &&
          pos.y === rect.y + rect.h-1,
      }));

      dmg.grid.createTile({
        pos: {x: 6, y: -8},
        kind: 'rune',
        classList: ['interact', 'solid', 'passable'],
        text: 'V',
        data: {
          name: 'void rune',
          morph_subject: "+support",
        },
      });

      const pos = {x: 6, y: 4};
      dmg.grid.createTile({pos, kind: 'char', classList: ['mover', 'solid', 'input'], text: '@'});
      dmg.grid.viewPoint = pos;

    </script>
  </body>

</html>
<!-- vim:set ts=2 sw=2 expandtab -->
