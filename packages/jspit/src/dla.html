<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="index.css" />
    <link rel="stylesheet" type="text/css" href="dla.css" />
    <title>jspit: Diffusion Limited Aggregation (DLA) demo</title>
  </head>
  <body>

    <header>
      <!-- TODO make this a slider / toggle button -->
      <button id="dropPlayer">Drop Player</button>
    </header>

    <main>
      <aside class="menu modal">
        <noscript>
          <section>
            <h3 class="error">Insufficient JavaScript to diffuse...</h3>
          </section>
        </noscript>

        <section>
          <h1>Diffusion Limited Aggregation</h1>

          This is actually a dual random walker and diffusion limited
          aggregation hybrid:
          <ul>
            <li>If a particle is spawned outside the world, it keeps moving until
              it touches the world, aggregating onto and expanding it.</li>
            <li>If a particle is spawned inside the world, it keeps moving until
              it exits the world, at which point it expand the world by one cell
              and dies.</li>
            <li>Particles may be spawned at seed points, or at random locations
              chosen in the void or within the world.</li>
            <li>Particles have a heading, and randomly turn within a fixed range
              each turn before advancing forward.</li>
            <li>Movement and aggregation happens along cardinal directions
              (up/down and left/right), and may optionally be allowed along
              ordinal directions (diagonally).</li>
          </ul>

          <fieldset><legend>Settings</legend><dl>

            <dt>Turns upto</dt>
            <dd><label for="dla-turnLeft">Left: Math.PI *</label>
              <input id="dla-turnLeft" name="turnLeft" type="number" min="0" max="1" step="0.2" />
            </dd>
            <dd><label for="dla-turnRight">Right: Math.PI *</label>
              <input id="dla-turnRight" name="turnRight" type="number" min="0" max="1" step="0.2" />
            </dd>

            <dt><label for="dla-bounds">Bounds</label></dt><dd>
              <input id="dla-bounds" name="bounds" size="32" type="text" />
            </dd>

            <dt><label for="dla-seeds">Seeds</label></dt><dd>
              <input id="dla-seeds" name="seeds" size="32" type="text" />
            </dd>

            <dt>Spawn Particles</dt>
            <dd>
              <label for="dla-initWhere">Where:</label>
              <select id="dla-initWhere" name="initWhere"></select>
            </dd>
            <dd>
              <label for="dla-initBase">Facing Math.PI * ( </label>
              <input id="dla-initBase" name="initBase" type="number" min="0" max="1" step="0.2" />
              <label for="dla-initArc">+/-</label>
              <input id="dla-initArc" name="initArc" type="number" min="0" max="1" step="0.2" /> )
            </dd>

            <dt>Particles Move</dt>

            <dd>
              <b>pre-player:</b>
              1 step <label for="dla-genRate">every</label>
              <input id="dla-genRate" name="genRate" type="number" min="1" max="100">ms
            </dd>

            <dd>
              <b>post-player:</b>
              1 step <label for="dla-playRate">every</label>
              <input id="dla-playRate" name="playRate" type="number" min="1" max="100">ms
            </dd>

            <dd><label for="dla-ordinalMoves">
              <input id="dla-ordinalMoves" name="ordinalMoves" type="checkbox" />
              Allow ordinal (diagonal) moves
            </label></dd>

            <dd>
              <label for="dla-stepLimit">Terminate after</label>
              <input id="dla-stepLimit" name="stepLimit" type="number" min="0" />
              steps; if set to <code>0</code> then <code>bounds.w + bounds.h</code> is used.
            </dd>

            <dt>Particle Limit</dt><dd>
              <label for="dla-particleLimit">Stop spawning after</label>
              <input id="dla-particleLimit" name="particleLimit" type="number" min="0" />;
              if set to <code>0</code> then <code>( bounds.w * bounds.h )/2</code> is used.
            </dd>

            <dt>Automatically Drop Player</dt>
            <dd><label for="dla-dropAfter">After</label>
              <input id="dla-dropAfter" name="dropAfter" type="number" min="0" max="10000" step="1" /> particles (0 disables)
            </dd>

          </dl></fieldset>

          <div class="buttonbar">
            <button id="run">Run</button>
            <button id="reset" disabled>Reset</button>
            <span style="float: right"><code>&lt;Escape&gt;</code> to show/hide this menu at any time</span>
            <br style="clear: both" />
          </div>

          <!-- TODO fieldset and #reset mutex? -->
        </section>

        <section>

          Inspired by
          <a href="//web.archive.org/web/20151003181050/http://codepen.io/DonKarlssonSan/full/BopXpq/">2015-10 codepen by DonKarlssonSan</a>
          <br>
          <br>

          Other resources:
          <ul>
            <li><a href"https://roguelike.club/event2020.html">Roguecel 2020 talk by Herbert Wolverson</a> demonstrated DLA among other techniques</li>
            <li><a href="//www.roguebasin.com/index.php?title=Diffusion-limited_aggregation">Roguebasin DLA article</a></li>
            <li><a href="//en.wikipedia.org/wiki/Diffusion-limited_aggregation">WikiPedia on the wider topic</a></li>
            <li><a href="//paulbourke.net/fractals/dla/">Paul Boruke, reference from DonKarlssonSan</a></li>
          </ul>

        </section>

        <section>
          <h3>
            <div class="version" style="float: right"></div>
            <a href="index.html">Back to Welcome screen</a>
          </h3>
        </section>

      </aside>
      <div class="grid"></div>
    </main>

    <footer>
      <div class="status" style="float: left"></div>
      <div class="version" style="float: right"></div>
    </footer>

    <script type="module">
      import {init} from './dla';
      init({
        status: document.querySelector('footer .status'),
        menu: document.querySelector('main .menu'),
        grid: document.querySelector('main .grid '),
        keys: document.body,
        version: document.querySelectorAll('.version'),
        run: document.querySelector('#run'),
        reset: document.querySelector('#reset'),
        dropPlayer: document.querySelector('#dropPlayer'),
      });
    </script>
  </body>

</html>
<!-- vim:set ts=2 sw=2 expandtab -->
